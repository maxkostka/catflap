{
  "name": "Catflap",
  "tagline": "Catflap with raspberry pi plus camera and image recognition to keep the cat from bringing prey inside",
  "body": "# catflap\r\nThe catflap for detecting prey in the cats snout.\r\nBased on a raspberry pi 2 with the raspicam and the catflap sureflap.\r\nThe raspberry runs ubuntu with ros indigo, python 2.x opencv.\r\nThe system has 4 sensors, two ir sensors to detect the presence of a cat in the catflap tunnel, a sensor to check, whether the status of the flap and a camera to take pictures of the cats profile.\r\n\r\nI further think that the original idea was not created by the three youngsters or at least they were not the only ones.\r\nI was further inspired by joakim soderberg and the catcierge https://joakimsoderberg.github.io/catcierge/ (Nice work Joakim!) and the flow control project which can no longer be found on the web (origial url: http://www.quantumpicture.com/Flo_Control/flo_control.htm) but we can find some remaints of its impact on others http://www.openscience.org/blog/?p=109.\r\n\r\nAt least four years after the flo control project, three germans participated in a contest called 'jugend forscht' http://www.neumarktonline.de/art.php?newsid=59507). The price was patent application http://www.freepatentsonline.com/DE202009002677.html which is currently owned by the Feldberglicht GmbH. They are still developing a commercial application - check it out http://www.mouse-lock.de/. But don't expect a working catflap before a working fusion reactor ;)\r\n\r\nusage so far\r\n`roslaunch catflap_training.launch`\r\nto start the ros nodes to aquire images, when a cat passes the flap\r\n\r\ni added the startup.sh via\r\n`sudo crontab -e`\r\njust add a line like \r\n`@reboot /home/max/projects/catflap/ros_catkin_ws/src/startup.sh >>/home/max/projects/catflap/log_launch 2>&1`\r\nto start it at when the raspi boots up.\r\n\r\n\r\nWhat it looks like:\r\n![charlie and her catflap]( catflap/images/catflap.jpg )\r\n![catflap seen from inside]( catflap/images/from_inside_1.jpg )\r\n![catflap open - backlight on]( catflap/images/from_inside_2_backlight.jpg )\r\n![peek through to the right - outer ir sensor]( catflap/images/peek_inside_right_ir_sensor.jpg )\r\n![peek through, look to the right raspi cam]( catflap/images/peek_inside_right side_raspi_cam.jpg )\r\n![charlie inspecting the catflap]( catflap/images/cat_inspection_1.jpg )\r\n![charlie inspecting the catflap]( catflap/images/cat_inspection_2.jpg )\r\n![build phase - testing the backlight]( catflap/images/raspi_prototype_backlight.jpeg )\r\n\r\n# Why I need a catflap and how i thought it should work\r\nMy work is based on a SureFlap catflap that I bought three years ago. It has the feature to learn the signature of certain RFID devices which are used to tag cats, and release the catflap lock only for known RFID signatures.\r\nI bought the catflap as it has a convenient locking mechanism included. We had two cats at that time. They embraced their freedom to come and leave as they wanted and - as any decent cat would do - brought back prey from time to time as a present - as a proof of their love.\r\nI planned on stopping the - to me sometimes very disgusting - presents with a raspberry pi I had at home. The idea was to pictures of the cat before it enters the flap, and with some image recognition, release the lock only when there is no prey in the cats snout. I build a housing to mount it in front of my catflap, which contained the raspberry pi together with the raspi cam, two ir sensors mounted at the entrance of the housing an a IR LED spotlight behind the camera, lighting the cat that enters.\r\nAfter a while I switched to a setup using backlight and modified my housing accordingly, as my plans were to work on black and white images of the cats contours.\r\nI want to show you two images with very nice presents:)\r\n![my cat Socke with a mouse]( catflap/images/prototype1_prey_1.png )\r\n![dont know which cat with gutted blackbird]( catflap/images/prototype1_prey_1.png )\r\nUnfortunately, my cat Luigi was hit by a car and died, and the other cat Socke lived with us for some more months. At some day she just didn't return home. We never found out what happened to her, hopefully she just found a new home.\r\nSo this was the end of the catflap plans - prototype one.\r\n\r\n# The new cats on the block\r\nA little down the road we decided to get two new cats. Since Socke and Luigi had a lot of bad luck, we did not want to let them go outdoors. Bad luck did not end here, one of the two, called Kitty died soon after we got her [FIP](https://en.wikipedia.org/wiki/Feline_infectious_peritonitis)\r\nSo we were a one cat household with an indoor cat.\r\nBut a little further down the road our household got a new fellow lodger, the cutest baby in the world :) And things got worse with our cat Charlie. She simply has a loooooot of energy that she could not for her life shake off during her day or her night. So after some artistic high speed stunts involving rayor sharp claws very close to our baby we decided that Charlie should indeed be an outdoor cat again. This time the catflap would lead her to the garden, and not he front door, minimizing the need to cross the street there and the according risks of getting hit by a car or something.\r\nIn her first night out our cat must have been replaced by someone or at least brainwashed. The standoffish cat left and a snuggly cat returned home. But it's ok for us, she still looks the same:)\r\n\r\n# Time for a new catflap prototype\r\nConsidering the energy Charlie displayed so far I expected her to bring home a small deer or one of the neighbours dogs at least on one of her next next nightly tours. we were lucky so far, she only brought in small insects.\r\n![charlie bringing home a small insect]( catflap/images/charlie_insect.jpg )\r\nIn the meantime a raspberry pi 2 was bought, a new housing was constructed and I heard about ros and wanted to try it out. And here we are with the catflap.\r\nRight now it can aquire images, when a cat enters the door and does not take pictures when the door is already open, or when a cat is leaving the house.\r\n\r\n# How the protoype works right now:\r\nTwo IR sensors detect when Charlie enters the housing. A door sensor detects, if the door is closed or open.\r\nWhen a the IR sensors are active and the door is closed and an internal timeout has elapsed, the backlight is turned on and an image is recorded, saved, and the backlight is turned off. A timeout is set to a certain short period then (under a second). If the IR sensors are still active, the door is still closed when the timeout has elapsed, the light is turned on again, image recorded ... timeout is set again ... and so on until the door is opened.\r\nAs long as the door is open no image will be recorded. When the door closes, a timeout is set to a certain long period to get a certain dead time (about 5 seconds).\r\n\r\n\r\nThe next steps are:\r\n* refactor the timeout and dead time. The camera should detect, when a cat leaves the house and only start recording images, when the cat has left the housing for a certain time. So far it starts recording when the door was closed for a certain time.\r\n* aquire lot of training images\r\n* train a classifier to detect the snout in the image\r\n* do something to detect prey in the snout - I don't have concrete plans here\r\n* electrically connect the sureflaps locking mechanism to the raspi or mount a servo on the locking mechanic.\r\n* install a second door before the RFID tunnel of the SureFlap - to keep the cat in the cameras field of view (The SureFlap has a RFID tunnel of about 10cm in length before the door. The camera can't see the cats head when she is standing right in front of the locked door, waiting for the lock to release. A second door, closing just with the end of the tunnel, mechanically connected with the inner door should do the job to keep the cat in the field of view)\r\n* create a new ros node for lock - release logic\r\n* create a new node for mailing a thumbnail picture plus lock/release decision\r\n* some more ideas will certainly come along\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}